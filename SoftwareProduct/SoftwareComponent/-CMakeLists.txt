## CMakeLists @ SoftwareComponent Directory 
cmake_minimum_required(VERSION 3.23)
set(SOFWARE_COMPONENT_NAME SoftwareComponent)
project(${SOFWARE_COMPONENT_NAME} LANGUAGES C VERSION 5.4.3)

#Options
option(BUILD_COMPONENT_TEST "Build Component Testing" OFF)
option(BUILD_COMPONENT_CLI "Build Command-In-Line Interfaces for the LSTime Software Component" ON)

if(BUILD_COMPONENT_TEST STREQUAL "ON")
	set(BUILD_COMPONENT_CLI ON)
endif()

add_library(${SOFWARE_COMPONENT_NAME} sources/SoftwareComponent.c sources/SoftwareComponent.h)
target_include_directories(${SOFWARE_COMPONENT_NAME} PUBLIC "${PROJECT_BINARY_DIR}" )

if(BUILD_COMPONENT_CLI STREQUAL "ON")
    add_executable(${SOFWARE_COMPONENT_NAME}Shell sources/main.c )
    target_link_libraries(${SOFWARE_COMPONENT_NAME}Shell PUBLIC ${SOFWARE_COMPONENT_NAME})
endif()

if (MSVC)
	set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS ON)
endif()

#Test
if(BUILD_COMPONENT_TEST STREQUAL "ON")
    message("Build Component Testing...")
    enable_testing()
    function(ComponentTest target arg result)
        add_test(NAME "ComponentTest ${arg}" COMMAND ${target} ${arg})
        set_tests_properties("ComponentTest ${arg}" PROPERTIES PASS_REGULAR_EXPRESSION ${result})
    endfunction()

    #CLI ./SoftwareComponentShell --version  			Expected: Local Sidereal Time: 2.74046 @ LNG: 1 @ 01/01/1968 00:00:00
    #ComponentTest(LSTime --lng 0 "Local Sidereal Time: 2.74046 @ LNG: 0 @ 01/01/1968 00:00:00")

endif()







#Install/Depository
install(TARGETS ${SOFWARE_COMPONENT_NAME} 
	EXPORT ${SOFWARE_COMPONENT_NAME}Targets
	FILE_SET HEADERS
	LIBRARY DESTINATION lib
	ARCHIVE DESTINATION lib
	RUNTIME DESTINATION bin
	INCLUDES DESTINATION inc)

#install(EXPORT ${SOFWARE_COMPONENT_NAME}Targets
#	FILE ${SOFWARE_COMPONENT_NAME}Targets.cmake
#	DESTINATION lib/cmake/${SOFWARE_COMPONENT_NAME})

install(FILES
                    ${CMAKE_CURRENT_SOURCE_DIR}/inc/${SOFWARE_COMPONENT_NAME}_API.h
                DESTINATION
                    "inc")

include(CMakePackageConfigHelpers)
write_basic_package_version_file(
	"${SOFWARE_COMPONENT_NAME}Version.cmake"
	VERSION ${SOFTWARE_COMPONENT_VERSION}
	COMPATIBILITY AnyNewerVersion)

install(FILES "${SOFWARE_COMPONENT_NAME}Config.cmake" "${CMAKE_CURRENT_BINARY_DIR}/${SOFWARE_COMPONENT_NAME}Version.cmake"
	DESTINATION lib/cmake/${SOFWARE_COMPONENT_NAME})

#/usr/local/bin/cmake --no-warn-unused-cli 
#-DCMAKE_BUILD_TYPE:STRING=Debug 
#-DCMAKE_EXPORT_COMPILE_COMMANDS:BOOL=TRUE 
#-DCMAKE_C_COMPILER:FILEPATH=/usr/bin/clang 
#-DCMAKE_CXX_COMPILER:FILEPATH=/usr/bin/clang++ 
#S/Users/sgabre/git/CrazyUncleLab/SoftwareProduct/SoftwareComponent 
#-B/Users/sgabre/git/CrazyUncleLab/build -G "Unix Makefiles"Â 